# StrawHub

Role and skill registry for [Strawpot](https://github.com/user/strawpot).

## Overview

StrawHub is a web service that lets users discover, publish, and install reusable roles and skills for Strawpot agents. Following the same architecture as [ClawHub](https://clawhub.ai/), it extends the pattern to manage both **roles** and **skills** with recursive dependency resolution.

- **Roles** define agent behavior, default tools, model config, and dependent skills
- **Skills** are markdown instruction modules that agents load into context
- Skills can depend on other skills; roles depend on skills
- Dependencies are resolved recursively on install

## Features

- **Browse & Search** — discover skills and roles with vector + lexical search
- **Publish** — upload SKILL.md / ROLE.md files via web UI or REST API
- **GitHub Import** — paste a GitHub repo URL to fetch and publish directly
- **Dashboard** — manage your published skills and roles
- **Settings** — edit profile (display name, bio), manage API tokens, delete account
- **GitHub OAuth** — sign in with GitHub, avatar and @handle shown in nav
- **API Tokens** — create bearer tokens for CLI / programmatic access
- **Dependency Resolution** — roles declare skill dependencies resolved recursively on install

## Tech Stack

- **Frontend**: Vite + React 19 + TanStack Router + Tailwind CSS v4
- **Backend**: Convex (serverless DB + file storage + HTTP actions)
- **Auth**: GitHub OAuth via `@convex-dev/auth`
- **Search**: OpenAI embeddings + Convex vector search + lexical boosting
- **Analytics**: Vercel Analytics + Speed Insights
- **E2E Testing**: Playwright (Chromium)
- **Unit Testing**: Vitest
- **CI/CD**: GitHub Actions + Vercel (frontend) + Convex (backend)

## Development

### Prerequisites

- Node.js 22+
- A [Convex](https://convex.dev) project
- A [GitHub OAuth App](https://github.com/settings/developers)

### Setup

```bash
# Install dependencies
npm install

# Initialize Convex (first time only)
npx convex dev --once

# Generate JWT keys for Convex Auth
npx @convex-dev/auth setup
```

### Environment Variables

Set the following on your Convex deployment (via `npx convex env set` or the Convex dashboard):

| Variable | Description |
|----------|-------------|
| `AUTH_GITHUB_ID` | GitHub OAuth App client ID |
| `AUTH_GITHUB_SECRET` | GitHub OAuth App client secret |
| `SITE_URL` | Your app's public URL (e.g. `http://localhost:5173` for dev) |
| `CONVEX_SITE_URL` | Convex HTTP endpoint (e.g. `https://your-deployment.convex.site`) |
| `JWT_PRIVATE_KEY` | Generated by `npx @convex-dev/auth setup` |
| `JWKS` | Generated by `npx @convex-dev/auth setup` |

Local `.env.local` (created automatically by `npx convex dev`):

```
CONVEX_DEPLOYMENT=dev:your-deployment
VITE_CONVEX_URL=https://your-deployment.convex.cloud
VITE_CONVEX_SITE_URL=https://your-deployment.convex.site
```

### Run

```bash
# Start dev server (Convex + Vite concurrently)
npm run dev

# Type check
npm run typecheck
```

### Production Deployment

**Frontend** is deployed on [Vercel](https://vercel.com), auto-deploys on push to `main`.

Set `VITE_CONVEX_URL` in the Vercel dashboard (Settings > Environment Variables).

**Backend** is deployed via GitHub Actions on push to `main`. Requires the `CONVEX_DEPLOY_KEY` secret in the GitHub repo settings.

## API

Full API documentation: [docs/http-api.md](docs/http-api.md)

```
GET  /api/v1/skills                  # list skills
GET  /api/v1/skills/{slug}           # get skill detail
GET  /api/v1/skills/{slug}/file      # get raw file content
GET  /api/v1/roles                   # list roles
GET  /api/v1/roles/{slug}            # get role detail
GET  /api/v1/roles/{slug}/resolve    # resolve dependencies recursively
GET  /api/v1/search?q=...            # search skills and roles
POST /api/v1/skills                  # publish skill (bearer token required)
POST /api/v1/roles                   # publish role (bearer token required)
GET  /api/v1/whoami                  # validate token
```

Authenticated endpoints require an `Authorization: Bearer <token>` header. Create tokens from the Settings page.

## Content Formats

### SKILL.md

```yaml
---
name: git-workflow
version: 1.0.0
description: "Git branching and commit conventions"
tags: [git, workflow]
author: strawpot
---

# Git Workflow

Instructions for the agent...
```

### ROLE.md

Dependencies are declared directly in the frontmatter. Version specifiers are optional.

```yaml
---
name: implementer
version: 1.0.0
description: "Writes code to implement features and fix bugs"
tags: [coding, implementation]
author: strawpot
dependencies:
  - git-workflow>=1.0.0
  - code-review
  - python-testing^2.0.0
default_tools:
  allowed: [Bash, Read, Write, Edit, Glob, Grep]
default_model:
  provider: claude_session
  id: claude-opus-4-6
---

# Implementer

Role instructions for the agent...
```

### Dependency Version Specifiers

| Format | Meaning | Example |
|--------|---------|---------|
| `slug` | Latest version | `git-workflow` |
| `slug==X.Y.Z` | Exact version | `git-workflow==1.0.0` |
| `slug>=X.Y.Z` | Minimum version | `git-workflow>=1.0.0` |
| `slug^X.Y.Z` | Compatible (same major, >= specified) | `git-workflow^1.0.0` |

## Testing

```bash
# Unit tests
npm test

# Unit tests (CI, single run)
npm run test:ci

# E2E tests (builds app, runs Playwright)
npm run test:e2e

# Coverage
npm run coverage
```
